<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CRM Follow Up</title>

<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">

<style>
:root{
  --brand:#1c8c6e;
  --bg:#f6fbf9;
  --border:#ddd;
}
*{box-sizing:border-box}
body{
  font-family:"Prompt",sans-serif;
  background:var(--bg);
  margin:0;
  padding:16px;
}

/* ===== Dashboard ===== */
.dashboard{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
  gap:12px;
  margin-bottom:16px;
}
.stat{
  background:#fff;
  border-radius:14px;
  padding:14px;
  text-align:center;
}
.stat span{
  display:block;
  font-size:28px;
  font-weight:600;
}
.green{background:#e6f7ee}
.yellow{background:#fff8d6}
.orange{background:#ffe3c2}
.red{background:#ffd6d6}

/* ===== Form ===== */
.form-box{
  background:#fff;
  padding:18px;
  border-radius:18px;
  margin-bottom:20px;
}
.form-grid{
  display:grid;
  grid-template-columns:repeat(6,1fr);
  gap:12px;
}
input,textarea{
  width:100%;
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px;
  font-family:"Prompt",sans-serif;
  font-size:15px;
}
input{height:50px}
textarea{min-height:110px;resize:vertical}
button.main{
  width:100%;
  margin-top:14px;
  padding:14px;
  border:none;
  border-radius:16px;
  background:var(--brand);
  color:#fff;
  font-size:16px;
}

/* ===== Table ===== */
.table-box{
  background:#fff;
  border-radius:18px;
  overflow:hidden;
}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:12px;
  border-bottom:1px solid #eee;
  font-size:14px;
  vertical-align:top;
}
th{background:#f2f7f5}

/* ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ */
th.col-action,
td.col-action{
  width:130px;
  white-space:nowrap;
  text-align:center;
}

/* ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î */
td.col-note{
  white-space:pre-line;
  line-height:1.5;
  color:#555;
}

/* ===== Buttons ===== */
.btn-action{
  width:100%;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:6px;
  padding:8px 10px;
  border:none;
  border-radius:10px;
  font-size:14px;
  font-weight:500;
  color:#fff;
  cursor:pointer;
}
.btn-action .icon{font-size:16px}

.btn-edit{
  background:linear-gradient(135deg,#ffb74d,#fb8c00);
}

.btn-delete{
  background:linear-gradient(135deg,#ff6b6b,#e53935);
  margin-top:6px;

  /* üî¥ FIX MOBILE DELETE */
  pointer-events:auto;
  touch-action:manipulation;
  position:relative;
  z-index:10;
}

/* ===== Mobile Cards ===== */
.card-list{display:none}
.card{
  background:#fff;
  border-radius:16px;
  padding:14px;
  margin-bottom:12px;
  border-left:6px solid var(--brand);
}
.card.green{border-color:#2e7d32}
.card.yellow{border-color:#f9a825}
.card.orange{border-color:#ef6c00}
.card.red{border-color:#c62828}
.card .title{font-weight:600}
.card .meta{font-size:14px;color:#666;margin-top:4px}
.card .note{margin-top:8px;font-size:14px;color:#444}
.card .actions{margin-top:12px}

/* ===== Calendar ===== */
.calendar{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.35);
  display:none;
  align-items:center;
  justify-content:center;
}
.calendar-box{
  background:#fff;
  border-radius:16px;
  padding:16px;
  width:300px;
}
.calendar-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
}
.calendar-grid{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:6px;
  text-align:center;
}
.calendar-grid .day{
  padding:8px;
  border-radius:8px;
  cursor:pointer;
}
.calendar-grid .day:hover{background:#e6f7ee}

/* ===== Responsive ===== */
@media(max-width:768px){
  .form-grid{grid-template-columns:1fr}
  .table-box{display:none}
  .card-list{display:block}
}
</style>
</head>

<body>

<h2>üìä CRM ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h2>

<div class="dashboard">
  <div class="stat green">‡∏õ‡∏Å‡∏ï‡∏¥<span id="dGreen">0</span></div>
  <div class="stat yellow">‡∏Ñ‡∏ß‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°<span id="dYellow">0</span></div>
  <div class="stat orange">‡πÄ‡∏£‡πà‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°<span id="dOrange">0</span></div>
  <div class="stat red">‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á<span id="dRed">0</span></div>
</div>

<div class="form-box">
  <div class="form-grid">
    <input id="fDate" placeholder="‡∏ß‡∏±‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ (‡∏û.‡∏®.)" readonly onclick="openCalendar()">
    <input id="fName" placeholder="‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•">
    <input id="fContact" placeholder="‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠">
    <input id="fDepartment" placeholder="‡πÅ‡∏ú‡∏ô‡∏Å">
    <input id="fProvince" placeholder="‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î">
    <textarea id="fNote" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î"></textarea>
  </div>
  <button class="main" onclick="saveEntry()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
</div>

<!-- ===== Table (Desktop) ===== -->
<div class="table-box">
<table>
<thead>
<tr>
  <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
  <th>‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</th>
  <th>‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</th>
  <th>‡πÅ‡∏ú‡∏ô‡∏Å</th>
  <th>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</th>
  <th>‡∏ß‡∏±‡∏ô</th>
  <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
  <th class="col-action">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>

<!-- ===== Mobile Cards ===== -->
<div class="card-list" id="cardList"></div>

<!-- Calendar -->
<div class="calendar" id="calendar">
  <div class="calendar-box">
    <div class="calendar-header">
      <button onclick="changeMonth(-1)">‚óÄ</button>
      <div id="calTitle"></div>
      <button onclick="changeMonth(1)">‚ñ∂</button>
    </div>
    <div class="calendar-grid" id="calGrid"></div>
  </div>
</div>

<script>
const KEY="crm_entries";
let entries=JSON.parse(localStorage.getItem(KEY))||[];
let editIndex=null;

/* ===== Calendar ===== */
let cDate=new Date();
function openCalendar(){
  calendar.style.display="flex";
  renderCalendar();
}
function changeMonth(n){
  cDate.setMonth(cDate.getMonth()+n);
  renderCalendar();
}
function renderCalendar(){
  const y=cDate.getFullYear(), m=cDate.getMonth();
  calTitle.textContent=
    cDate.toLocaleString("th-TH",{month:"long"})+" "+(y+543);
  calGrid.innerHTML="";
  const first=new Date(y,m,1).getDay();
  const days=new Date(y,m+1,0).getDate();
  for(let i=0;i<first;i++)calGrid.innerHTML+="<div></div>";
  for(let d=1;d<=days;d++){
    const el=document.createElement("div");
    el.className="day";
    el.textContent=d;
    el.onclick=()=>{
      fDate.value=
        `${String(d).padStart(2,"0")}/${String(m+1).padStart(2,"0")}/${y+543}`;
      calendar.style.display="none";
    };
    calGrid.appendChild(el);
  }
}

/* ===== Utils ===== */
function parseDate(d){
  const [dd,mm,yy]=d.split("/");
  return new Date(yy-543,mm-1,dd);
}
function daysSince(d){
  return Math.floor((new Date()-parseDate(d))/86400000);
}
function status(d){
  return d<=7?"green":d<=14?"yellow":d<=21?"orange":"red";
}

/* ===== Save / Edit / Delete ===== */
function saveEntry(){
  const data={
    date:fDate.value,name:fName.value,contact:fContact.value,
    dept:fDepartment.value,province:fProvince.value,note:fNote.value
  };
  if(editIndex!==null){
    entries[editIndex]=data;
    editIndex=null;
  }else{
    entries.push(data);
  }
  localStorage.setItem(KEY,JSON.stringify(entries));
  fDate.value=fName.value=fContact.value=fDepartment.value=fProvince.value=fNote.value="";
  render();
}
function editEntry(i){
  const e=entries[i];
  fDate.value=e.date;
  fName.value=e.name;
  fContact.value=e.contact;
  fDepartment.value=e.dept;
  fProvince.value=e.province;
  fNote.value=e.note;
  editIndex=i;
  window.scrollTo({top:0,behavior:"smooth"});
}
function deleteEntry(i){
  if(!confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")) return;
  entries.splice(i,1);
  localStorage.setItem(KEY,JSON.stringify(entries));
  render();
}

/* ===== Render ===== */
function render(){
  tbody.innerHTML="";
  cardList.innerHTML="";
  let g=0,y=0,o=0,r=0;

  entries.forEach((e,i)=>{
    const d=daysSince(e.date);
    const s=status(d);
    if(s==="green")g++;
    else if(s==="yellow")y++;
    else if(s==="orange")o++;
    else r++;

    tbody.innerHTML+=`
      <tr>
        <td>${e.date}</td>
        <td>${e.name}</td>
        <td>${e.contact}</td>
        <td>${e.dept}</td>
        <td>${e.province}</td>
        <td>${d}</td>
        <td class="col-note">${e.note||""}</td>
        <td class="col-action">
          <button class="btn-action btn-edit" onclick="editEntry(${i})">
            <span class="icon"‚úèÔ∏è</span>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
          </button>
          <button
            class="btn-action btn-delete"
            onclick="deleteEntry(${i})"
            ontouchstart="event.stopPropagation(); deleteEntry(${i});">
            <span class="icon">üóëÔ∏è</span>‡∏•‡∏ö
          </button>
        </td>
      </tr>
    `;

    cardList.innerHTML+=`
      <div class="card ${s}">
        <div class="title">${e.name}</div>
        <div class="meta">${e.contact} | ${e.dept}</div>
        <div class="meta">${e.province} ‚Ä¢ ${e.date}</div>
        <div class="note">${e.note||""}</div>
        <div class="actions">
          <button class="btn-action btn-edit" onclick="editEntry(${i})">
            <span class="icon">‚úèÔ∏è</span>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
          </button>
          <button
            class="btn-action btn-delete"
            onclick="deleteEntry(${i})"
            ontouchstart="event.stopPropagation(); deleteEntry(${i});">
            <span class="icon">üóëÔ∏è</span>‡∏•‡∏ö
          </button>
        </div>
      </div>
    `;
  });

  dGreen.textContent=g;
  dYellow.textContent=y;
  dOrange.textContent=o;
  dRed.textContent=r;
}
render();
</script>

</body>
</html>
